# TAD Framework - Project Type Detection Configuration
# Version: 1.2 (MCP Integration)
# Purpose: æ™ºèƒ½æ£€æµ‹é¡¹ç›®ç±»å‹å¹¶æ¨èå¯¹åº”çš„ Project-Layer MCP å·¥å…·

version: "1.2"
description: "Project type detection rules and MCP recommendation engine"
last_updated: "2025-01-30"

# ==================== æ£€æµ‹ç®—æ³•é…ç½® ====================
detection_algorithm:
  method: "weighted_scoring"
  description: "åŸºäºå…³é”®è¯æƒé‡å’Œæ–‡ä»¶æ¨¡å¼çš„ç»¼åˆè¯„åˆ†ç³»ç»Ÿ"

  scoring_formula: |
    Total Score = (Keyword Score Ã— 0.6) + (File Pattern Score Ã— 0.3) + (Tech Stack Score Ã— 0.1)

    Confidence = Total Score / Max Possible Score

    If Confidence > Threshold:
      â†’ Project Type Detected
    Else:
      â†’ No Clear Type (skip Round 2.5)

  minimum_confidence: 0.5
  recommendation_threshold: 0.6

# ==================== é¡¹ç›®ç±»å‹å®šä¹‰ ====================
project_types:

  # 1. Web å…¨æ ˆåº”ç”¨
  web_fullstack:
    name: "Web Fullstack Application"
    name_cn: "Web å…¨æ ˆåº”ç”¨"
    icon: "ğŸŒ"
    confidence_threshold: 0.7
    description: "ç°ä»£ Web åº”ç”¨(å‰ç«¯+åç«¯+æ•°æ®åº“)"

    keywords:
      tier1:  # é«˜æƒé‡å…³é”®è¯ (æƒé‡: 10)
        - "Next.js"
        - "React"
        - "Vue"
        - "Nuxt"
        - "SvelteKit"
        - "Remix"

      tier2:  # ä¸­æƒé‡å…³é”®è¯ (æƒé‡: 7)
        - "web"
        - "ç½‘ç«™"
        - "å…¨æ ˆ"
        - "frontend"
        - "backend"
        - "å‰ç«¯"
        - "åç«¯"
        - "API"
        - "REST"
        - "GraphQL"

      tier3:  # ä½æƒé‡å…³é”®è¯ (æƒé‡: 5)
        - "Tailwind"
        - "CSS"
        - "å“åº”å¼"
        - "ç”¨æˆ·ç•Œé¢"
        - "UI"
        - "è·¯ç”±"
        - "çŠ¶æ€ç®¡ç†"
        - "æœåŠ¡ç«¯æ¸²æŸ“"
        - "SSR"
        - "SSG"

    tech_stack_indicators:
      frameworks:
        - "Next.js"
        - "React"
        - "Vue"
        - "Angular"
        - "Svelte"

      backend:
        - "Node.js"
        - "Express"
        - "Fastify"
        - "Hono"
        - "tRPC"

      database:
        - "Supabase"
        - "PostgreSQL"
        - "MySQL"
        - "MongoDB"
        - "Prisma"

      deployment:
        - "Vercel"
        - "Netlify"
        - "Railway"
        - "Fly.io"

    file_patterns:
      high_confidence:  # æƒé‡: 15
        - "package.json"
        - "next.config.js"
        - "next.config.ts"
        - "vite.config.js"
        - "vite.config.ts"

      medium_confidence:  # æƒé‡: 10
        - "tsconfig.json"
        - "tailwind.config.js"
        - "postcss.config.js"
        - ".env.local"
        - "vercel.json"

      low_confidence:  # æƒé‡: 5
        - "src/app/"
        - "src/pages/"
        - "src/components/"
        - "public/"
        - "styles/"

    recommended_mcps:
      priority_high:  # å¼ºçƒˆæ¨è
        - name: "supabase"
          reason: "æ•°æ®åº“å’Œåç«¯æœåŠ¡"
          efficiency_gain: "85%"

        - name: "playwright"
          reason: "E2E æµ‹è¯•è‡ªåŠ¨åŒ–"
          efficiency_gain: "80%"

      priority_medium:  # æ¨è
        - name: "vercel"
          reason: "ä¸€é”®éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ"
          efficiency_gain: "90%"

        - name: "react-mcp"
          reason: "React ç»„ä»¶å¼€å‘è¾…åŠ©"
          efficiency_gain: "60%"

    detection_confidence_levels:
      very_high: ">= 0.9"
      high: ">= 0.7"
      medium: ">= 0.5"
      low: "< 0.5"

  # 2. æ•°æ®ç§‘å­¦/åˆ†æé¡¹ç›®
  data_science:
    name: "Data Science/Analysis"
    name_cn: "æ•°æ®ç§‘å­¦/åˆ†æ"
    icon: "ğŸ“Š"
    confidence_threshold: 0.6
    description: "æ•°æ®åˆ†æã€å¯è§†åŒ–ã€æŠ¥è¡¨ç”Ÿæˆ"

    keywords:
      tier1:  # æƒé‡: 10
        - "æ•°æ®åˆ†æ"
        - "æ•°æ®ç§‘å­¦"
        - "data analysis"
        - "data science"
        - "pandas"
        - "jupyter"
        - "notebook"

      tier2:  # æƒé‡: 7
        - "å¯è§†åŒ–"
        - "visualization"
        - "å›¾è¡¨"
        - "æŠ¥è¡¨"
        - "dashboard"
        - "ä»ªè¡¨æ¿"
        - "æ•°æ®å¤„ç†"
        - "ETL"
        - "æ¸…æ´—"

      tier3:  # æƒé‡: 5
        - "CSV"
        - "Excel"
        - "SQL"
        - "æŸ¥è¯¢"
        - "ç»Ÿè®¡"
        - "åˆ†æ"
        - "æ¢ç´¢"
        - "EDA"

    tech_stack_indicators:
      languages:
        - "Python"
        - "R"
        - "Julia"

      libraries:
        - "pandas"
        - "numpy"
        - "matplotlib"
        - "seaborn"
        - "plotly"
        - "scipy"

      tools:
        - "Jupyter"
        - "JupyterLab"
        - "Google Colab"
        - "Databricks"

      databases:
        - "PostgreSQL"
        - "MySQL"
        - "BigQuery"
        - "Snowflake"

    file_patterns:
      high_confidence:  # æƒé‡: 15
        - "*.ipynb"
        - "requirements.txt"
        - "environment.yml"
        - "Pipfile"

      medium_confidence:  # æƒé‡: 10
        - "data/"
        - "datasets/"
        - "notebooks/"
        - "analysis/"
        - "*.csv"
        - "*.xlsx"

      low_confidence:  # æƒé‡: 5
        - "visualizations/"
        - "reports/"
        - "scripts/"
        - "utils/"

    recommended_mcps:
      priority_high:
        - name: "jupyter"
          reason: "äº¤äº’å¼æ•°æ®åˆ†æç¯å¢ƒ"
          efficiency_gain: "90%"

        - name: "pandas-mcp"
          reason: "æ•°æ®å¤„ç†å’Œæ¸…æ´—"
          efficiency_gain: "85%"

      priority_medium:
        - name: "antv-chart"
          reason: "ä¸“ä¸šæ•°æ®å¯è§†åŒ–"
          efficiency_gain: "75%"

        - name: "postgres-mcp-pro"
          reason: "æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–"
          efficiency_gain: "70%"

  # 3. æœºå™¨å­¦ä¹ é¡¹ç›®
  machine_learning:
    name: "Machine Learning"
    name_cn: "æœºå™¨å­¦ä¹ "
    icon: "ğŸ¤–"
    confidence_threshold: 0.8
    description: "æœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒã€éƒ¨ç½²ã€MLOps"

    keywords:
      tier1:  # æƒé‡: 10
        - "æœºå™¨å­¦ä¹ "
        - "æ·±åº¦å­¦ä¹ "
        - "ç¥ç»ç½‘ç»œ"
        - "machine learning"
        - "deep learning"
        - "neural network"
        - "æ¨¡å‹è®­ç»ƒ"
        - "model training"
        - "AI"
        - "äººå·¥æ™ºèƒ½"

      tier2:  # æƒé‡: 7
        - "PyTorch"
        - "TensorFlow"
        - "Keras"
        - "scikit-learn"
        - "HuggingFace"
        - "Transformers"
        - "LLM"
        - "GPT"
        - "BERT"

      tier3:  # æƒé‡: 5
        - "é¢„æµ‹"
        - "åˆ†ç±»"
        - "å›å½’"
        - "èšç±»"
        - "æ¨¡å‹"
        - "è¶…å‚æ•°"
        - "ä¼˜åŒ–"
        - "è®­ç»ƒ"
        - "æ¨ç†"
        - "éƒ¨ç½²"

    tech_stack_indicators:
      frameworks:
        - "PyTorch"
        - "TensorFlow"
        - "JAX"
        - "MXNet"

      libraries:
        - "scikit-learn"
        - "XGBoost"
        - "LightGBM"
        - "CatBoost"
        - "transformers"
        - "diffusers"

      tools:
        - "MLflow"
        - "Weights & Biases"
        - "TensorBoard"
        - "Optuna"
        - "Ray Tune"

      platforms:
        - "HuggingFace Hub"
        - "SageMaker"
        - "Vertex AI"
        - "Azure ML"

    file_patterns:
      high_confidence:  # æƒé‡: 15
        - "train.py"
        - "model.py"
        - "inference.py"
        - "requirements.txt"
        - "*.ipynb"

      medium_confidence:  # æƒé‡: 10
        - "models/"
        - "checkpoints/"
        - "experiments/"
        - "configs/"
        - "*.pth"
        - "*.h5"
        - "*.onnx"

      low_confidence:  # æƒé‡: 5
        - "data/"
        - "datasets/"
        - "logs/"
        - "wandb/"

    recommended_mcps:
      priority_high:
        - name: "jupyter"
          reason: "ML å®éªŒå’Œæ¢ç´¢"
          efficiency_gain: "90%"

        - name: "optuna"
          reason: "è‡ªåŠ¨è¶…å‚æ•°ä¼˜åŒ–"
          efficiency_gain: "85%"

        - name: "huggingface"
          reason: "æ¨¡å‹å‘ç°å’ŒåŠ è½½"
          efficiency_gain: "90%"

      priority_medium:
        - name: "zenml"
          reason: "MLOps ç®¡é“ç®¡ç†"
          efficiency_gain: "75%"

        - name: "mlflow"
          reason: "å®éªŒè¿½è¸ªå’Œæ¨¡å‹ç®¡ç†"
          efficiency_gain: "70%"

  # 4. DevOps/åŸºç¡€è®¾æ–½é¡¹ç›®
  devops:
    name: "DevOps/Infrastructure"
    name_cn: "DevOps/åŸºç¡€è®¾æ–½"
    icon: "âš™ï¸"
    confidence_threshold: 0.7
    description: "å®¹å™¨åŒ–ã€CI/CDã€äº‘åŸºç¡€è®¾æ–½"

    keywords:
      tier1:  # æƒé‡: 10
        - "DevOps"
        - "Kubernetes"
        - "K8s"
        - "Docker"
        - "å®¹å™¨"
        - "container"
        - "CI/CD"
        - "éƒ¨ç½²"
        - "deployment"

      tier2:  # æƒé‡: 7
        - "åŸºç¡€è®¾æ–½"
        - "infrastructure"
        - "äº‘"
        - "cloud"
        - "AWS"
        - "Azure"
        - "GCP"
        - "ç¼–æ’"
        - "orchestration"
        - "å¾®æœåŠ¡"
        - "microservices"

      tier3:  # æƒé‡: 5
        - "pod"
        - "helm"
        - "terraform"
        - "ansible"
        - "ç›‘æ§"
        - "æ—¥å¿—"
        - "å‘Šè­¦"
        - "è´Ÿè½½å‡è¡¡"
        - "è‡ªåŠ¨æ‰©å±•"

    tech_stack_indicators:
      container:
        - "Docker"
        - "Podman"
        - "containerd"

      orchestration:
        - "Kubernetes"
        - "Docker Swarm"
        - "Nomad"

      ci_cd:
        - "GitHub Actions"
        - "GitLab CI"
        - "Jenkins"
        - "CircleCI"
        - "ArgoCD"

      iac:
        - "Terraform"
        - "Pulumi"
        - "CloudFormation"
        - "Ansible"

      cloud:
        - "AWS"
        - "Azure"
        - "GCP"
        - "DigitalOcean"

    file_patterns:
      high_confidence:  # æƒé‡: 15
        - "Dockerfile"
        - "docker-compose.yml"
        - "kubernetes/"
        - "k8s/"
        - "*.tf"

      medium_confidence:  # æƒé‡: 10
        - ".github/workflows/"
        - ".gitlab-ci.yml"
        - "helm/"
        - "charts/"
        - "terraform/"

      low_confidence:  # æƒé‡: 5
        - "manifests/"
        - "deployments/"
        - "scripts/"
        - "ansible/"

    recommended_mcps:
      priority_high:
        - name: "kubernetes"
          reason: "K8s é›†ç¾¤ç®¡ç†å’Œéƒ¨ç½²"
          efficiency_gain: "85%"

        - name: "docker"
          reason: "å®¹å™¨æ„å»ºå’Œç®¡ç†"
          efficiency_gain: "80%"

      priority_medium:
        - name: "aws"
          reason: "AWS èµ„æºç®¡ç†"
          efficiency_gain: "75%"

        - name: "terminal"
          reason: "Shell å‘½ä»¤æ‰§è¡Œ"
          efficiency_gain: "70%"

        - name: "netdata"
          reason: "å®æ—¶ç›‘æ§å’Œå‘Šè­¦"
          efficiency_gain: "65%"

  # 5. åˆ›æ„/å¤šåª’ä½“é¡¹ç›®
  creative:
    name: "Creative/Multimedia"
    name_cn: "åˆ›æ„/å¤šåª’ä½“"
    icon: "ğŸ¨"
    confidence_threshold: 0.7
    description: "è®¾è®¡ã€è§†é¢‘ã€éŸ³é¢‘ã€åˆ›æ„å†…å®¹"

    keywords:
      tier1:  # æƒé‡: 10
        - "è®¾è®¡"
        - "design"
        - "Figma"
        - "è§†é¢‘"
        - "video"
        - "éŸ³é¢‘"
        - "audio"
        - "åˆ›æ„"
        - "creative"

      tier2:  # æƒé‡: 7
        - "UI/UX"
        - "ç•Œé¢è®¾è®¡"
        - "å¤šåª’ä½“"
        - "multimedia"
        - "ç¼–è¾‘"
        - "å‰ªè¾‘"
        - "æ¸²æŸ“"
        - "ç‰¹æ•ˆ"

      tier3:  # æƒé‡: 5
        - "Photoshop"
        - "PS"
        - "Premiere"
        - "PR"
        - "After Effects"
        - "AE"
        - "Illustrator"
        - "AI"
        - "åŸå‹"
        - "mockup"

    tech_stack_indicators:
      design_tools:
        - "Figma"
        - "Sketch"
        - "Adobe XD"
        - "Framer"

      video_tools:
        - "Premiere Pro"
        - "Final Cut Pro"
        - "DaVinci Resolve"
        - "After Effects"

      audio_tools:
        - "Audacity"
        - "Pro Tools"
        - "Logic Pro"
        - "Ableton"

      graphics:
        - "Photoshop"
        - "Illustrator"
        - "GIMP"
        - "Inkscape"

    file_patterns:
      high_confidence:  # æƒé‡: 15
        - "*.fig"
        - "*.psd"
        - "*.ai"
        - "*.prproj"
        - "*.aep"

      medium_confidence:  # æƒé‡: 10
        - "design/"
        - "assets/"
        - "mockups/"
        - "prototypes/"

      low_confidence:  # æƒé‡: 5
        - "images/"
        - "videos/"
        - "audio/"
        - "exports/"

    recommended_mcps:
      priority_high:
        - name: "figma"
          reason: "è®¾è®¡è½¬ä»£ç è‡ªåŠ¨åŒ–"
          efficiency_gain: "85%"

        - name: "video-audio-mcp"
          reason: "è§†é¢‘éŸ³é¢‘ç¼–è¾‘è‡ªåŠ¨åŒ–"
          efficiency_gain: "80%"

      priority_medium:
        - name: "adobe-mcp"
          reason: "Adobe å·¥å…·é›†æˆ"
          efficiency_gain: "75%"

# ==================== æ£€æµ‹æµç¨‹å®šä¹‰ ====================
detection_workflow:
  trigger_timing: "Round 2.5 (after tech stack confirmed in Round 2)"

  step1_collect_data:
    description: "æ”¶é›†æ£€æµ‹æ‰€éœ€çš„æ‰€æœ‰æ•°æ®"
    data_sources:
      - "Round 1-2 ç”¨æˆ·å¯¹è¯ä¸­çš„å…³é”®è¯"
      - "ç”¨æˆ·æ˜ç¡®æåˆ°çš„æŠ€æœ¯æ ˆ"
      - "é¡¹ç›®ç›®å½•ä¸­çš„æ–‡ä»¶åˆ—è¡¨ (if exists)"
      - "package.json æˆ– requirements.txt å†…å®¹ (if exists)"

  step2_keyword_analysis:
    description: "åˆ†æå…³é”®è¯å¹¶è®¡ç®—æƒé‡åˆ†æ•°"
    algorithm: |
      FOR each project_type:
        score = 0
        FOR each keyword mentioned by user:
          IF keyword in tier1:
            score += 10
          ELIF keyword in tier2:
            score += 7
          ELIF keyword in tier3:
            score += 5

        keyword_score[project_type] = score

  step3_file_pattern_check:
    description: "æ£€æŸ¥æ–‡ä»¶æ¨¡å¼ (å¦‚æœé¡¹ç›®å·²å­˜åœ¨)"
    algorithm: |
      FOR each project_type:
        score = 0
        FOR each file in project:
          IF file matches high_confidence pattern:
            score += 15
          ELIF file matches medium_confidence pattern:
            score += 10
          ELIF file matches low_confidence pattern:
            score += 5

        file_score[project_type] = score

  step4_tech_stack_verification:
    description: "éªŒè¯æ˜ç¡®æåˆ°çš„æŠ€æœ¯æ ˆ"
    algorithm: |
      FOR each project_type:
        match_count = 0
        FOR each tech mentioned by user:
          IF tech in tech_stack_indicators:
            match_count += 1

        tech_score[project_type] = match_count * 5

  step5_calculate_confidence:
    description: "è®¡ç®—æœ€ç»ˆç½®ä¿¡åº¦"
    formula: |
      total_score = (keyword_score Ã— 0.6) + (file_score Ã— 0.3) + (tech_score Ã— 0.1)

      max_possible_score = (max_tier1_keywords Ã— 10 Ã— 0.6) +
                          (max_file_patterns Ã— 15 Ã— 0.3) +
                          (max_tech_matches Ã— 5 Ã— 0.1)

      confidence = total_score / max_possible_score

      IF confidence >= project_type.confidence_threshold:
        â†’ DETECTED
      ELSE:
        â†’ NOT DETECTED

  step6_recommendation:
    description: "åŸºäºæ£€æµ‹ç»“æœæ¨è MCP å·¥å…·"
    action: |
      IF project_type detected:
        1. Display project type name and confidence
        2. Show icon and description
        3. List recommended MCPs (priority_high first)
        4. Explain efficiency gains
        5. Offer installation options (0-2)
      ELSE:
        Skip Round 2.5, continue to Round 3

# ==================== ç‰¹æ®Šæƒ…å†µå¤„ç† ====================
edge_cases:
  multiple_types_detected:
    description: "æ£€æµ‹åˆ°å¤šä¸ªé¡¹ç›®ç±»å‹"
    handling: |
      1. é€‰æ‹©ç½®ä¿¡åº¦æœ€é«˜çš„ç±»å‹
      2. å¦‚æœç½®ä¿¡åº¦ç›¸è¿‘ (< 0.1 å·®è·):
         - æ˜¾ç¤ºå¤šä¸ªæ£€æµ‹ç»“æœ
         - è®©ç”¨æˆ·é€‰æ‹©ä¸»è¦ç±»å‹
      3. å¯ä»¥å®‰è£…å¤šä¸ªç±»å‹çš„ MCP å·¥å…·

  no_type_detected:
    description: "æ²¡æœ‰æ£€æµ‹åˆ°æ˜ç¡®çš„é¡¹ç›®ç±»å‹"
    handling: |
      1. è·³è¿‡ Round 2.5
      2. ç›´æ¥ç»§ç»­åˆ° Round 3
      3. è®°å½•: "Project type: Generic/Mixed"
      4. åªä½¿ç”¨ Core Layer MCP å·¥å…·

  new_project_no_files:
    description: "å…¨æ–°é¡¹ç›®,æ²¡æœ‰ä»»ä½•æ–‡ä»¶"
    handling: |
      1. ä»…ä¾èµ–å…³é”®è¯å’ŒæŠ€æœ¯æ ˆæ£€æµ‹
      2. file_score = 0
      3. é™ä½ confidence_threshold (-0.1)
      4. å¢åŠ å…³é”®è¯æƒé‡ (0.7 instead of 0.6)

  user_disagrees:
    description: "ç”¨æˆ·ä¸åŒæ„æ£€æµ‹ç»“æœ"
    handling: |
      1. æ˜¾ç¤ºæ‰€æœ‰ 5 ç§é¡¹ç›®ç±»å‹
      2. è®©ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©
      3. è®°å½•: "User overrode detection: [type]"
      4. æ ¹æ®ç”¨æˆ·é€‰æ‹©æ¨è MCP

# ==================== æ£€æµ‹ç»“æœè¾“å‡ºæ ¼å¼ ====================
output_format:
  detection_message: |
    ---
    ğŸ¯ Project Type Detected: {project_type.icon} {project_type.name_cn}
    Confidence: {confidence}%

    Based on your requirements, I recommend installing these MCP tools:

    ğŸ“¦ Recommended Project-Layer MCPs:
    {FOR each mcp in priority_high}
    {priority}. âœ¨ {mcp.name} - {mcp.reason}
       Efficiency Gain: {mcp.efficiency_gain}
    {END FOR}

    {IF priority_medium exists}
    Additional Options:
    {FOR each mcp in priority_medium}
    {priority}. â­ {mcp.name} - {mcp.reason}
       Efficiency Gain: {mcp.efficiency_gain}
    {END FOR}
    {END IF}

    These tools will significantly improve development efficiency:
    - {benefit_1}
    - {benefit_2}
    - {benefit_3}

    Installation takes ~20-30 seconds.

    Install Options:
    0. Install all recommended (fastest) â†
    1. Let me choose which to install
    2. Skip for now (can install later with: tad mcp install)

    Select 0-2:
    ---

  no_detection_message: |
    [Internal Note: Project type unclear, skipping MCP recommendation]
    [Continue to Round 3]

# ==================== æ—¥å¿—å’Œè¿½è¸ª ====================
logging:
  enabled: true
  location: ".tad/logs/project_detection.log"
  format: "[{timestamp}] Detection: {project_type} | Confidence: {confidence} | User Decision: {decision}"

  tracked_data:
    - "Keywords mentioned"
    - "Files checked"
    - "Tech stack identified"
    - "Confidence scores per type"
    - "Final decision"
    - "MCPs recommended"
    - "User selection"

# ==================== æŒç»­æ”¹è¿› ====================
improvement:
  feedback_collection:
    enabled: true
    questions:
      - "Was the project type detection accurate?"
      - "Were the recommended MCPs useful?"
      - "Should we adjust the detection threshold?"

  tuning_recommendations:
    - "Review logs weekly"
    - "Adjust keyword weights based on accuracy"
    - "Update tech_stack_indicators with new tools"
    - "Fine-tune confidence thresholds"
