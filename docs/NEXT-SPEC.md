# NEXT.md 格式规范 v1.0

## 概述

NEXT.md 是项目级的行动日志，记录待办事项和完成历史。
所有任务同步到 Google Tasks，有日期的任务自动显示在 Calendar。

## 架构

```
项目A/NEXT.md ──┐
项目B/NEXT.md ──┼──→ PM/MASTER.md ←──→ Google Tasks
项目C/NEXT.md ──┘         │                  ↓
                          │            Calendar (自动显示)
                     同步回各项目
```

- **项目 NEXT.md**: 每个项目的行动日志
- **MASTER.md**: PersonalManager 的汇总文档，与 Google Tasks 双向同步
- **Google Tasks**: 主数据源（完成状态）
- **Calendar**: 自动显示有日期的任务（只读视图）

## 文件位置

| 文件 | 路径 | 用途 |
|------|------|------|
| 项目级 | `<project>/NEXT.md` | 单个项目的行动日志 |
| 汇总级 | `personal-manager/MASTER.md` | 跨项目任务汇总，与 Google 同步 |

## 分类结构

```markdown
# 下一步行动

## 今天
- [ ] 必须今天完成的任务

## 待办
- [ ] 还没排期的任务

## 阻塞
- [ ] 等待外部条件的任务

## 已完成
### 2025-W52
- [x] 已完成的任务 ✓12-23
- [x] 另一个完成的任务 ✓12-22

### 2025-W51
- [x] 上周完成的任务 ✓12-18
```

### 分类说明

| 分类 | 含义 | 操作频率 |
|------|------|---------|
| **今天** | 必须今天完成 | 每天早上更新 |
| **待办** | 未排期的任务 | 随时添加 |
| **阻塞** | 等待外部条件 | 定期检查 |
| **已完成** | 完成记录（按周归档） | 完成时移入 |

## 任务语法

### 基本格式

```markdown
- [ ] 未完成任务
- [x] 已完成任务
```

### 时间标签 @

| 格式 | 示例 | Google Tasks | Calendar 显示 |
|------|------|--------------|---------------|
| 日期+时间 | `@2025-12-25 14:00` | 截止 12-25 | 14:00 显示 |
| 只有日期 | `@2025-12-25` | 截止 12-25 | 06:00 显示（默认） |
| 只有时间 | `@14:00` | 今天截止 | 14:00 显示 |
| 无标签 | `- [ ] 任务` | 无截止日期 | 不显示 |

**设计说明：**
- 默认时间 06:00 是为了不与其他日程冲突
- 所有任务集中在早晨时段，便于一目了然查看当日任务

### 项目标签 []

仅在 MASTER.md 中使用，标识任务来源项目：

```markdown
- [ ] 完成用户认证 [photos-web]
- [ ] 修复登录 bug [personal-manager]
- [ ] 写周报 [work]
```

### 完成标记 ✓

完成任务时添加完成日期：

```markdown
- [x] 已完成的任务 ✓12-23
- [x] 另一个任务 ✓2025-12-22
```

## 完整示例

### 项目 NEXT.md

```markdown
# 下一步行动

## 今天
- [ ] 完成用户认证模块 @14:00
- [ ] 修复登录页面 bug

## 待办
- [ ] API 重构 @2025-12-28
- [ ] 添加单元测试
- [ ] 性能优化

## 阻塞
- [ ] 等待设计稿确认后开始 UI 开发

## 已完成
### 2025-W52
- [x] 数据库迁移 ✓12-23
- [x] 项目初始化 ✓12-22

---
*最后更新: 2025-12-23*
```

### MASTER.md（汇总）

```markdown
# 任务汇总

## 今天
- [ ] 完成用户认证模块 @14:00 [photos-web]
- [ ] 修复登录页面 bug [photos-web]
- [ ] 更新文档 [personal-manager]

## 待办
- [ ] API 重构 @2025-12-28 [photos-web]
- [ ] 添加同步功能 [personal-manager]

## 阻塞
- [ ] 等待设计稿确认 [photos-web]

## 已完成
### 2025-W52
- [x] 数据库迁移 ✓12-23 [photos-web]
- [x] 规范文档 ✓12-23 [personal-manager]

---
*最后同步: 2025-12-23 09:00*
```

## 状态流转

```
┌─────────────────────────────────────┐
│                                     │
│   待办 ──────→ 今天 ──────→ 已完成  │
│     │           ↑                   │
│     └────→ 阻塞 ┘                   │
│                                     │
└─────────────────────────────────────┘
```

## 同步规则

### 数据流向

```
1. 规划：在项目 NEXT.md 添加任务
2. 汇总：pm next → 生成 MASTER.md
3. 推送：pm next --push → 同步到 Google Tasks
4. 执行：在手机/网页勾选完成
5. 拉取：pm next --pull → 同步完成状态回 MASTER.md
6. 分发：MASTER.md → 更新各项目 NEXT.md
```

### Source of Truth

| 数据类型 | 主数据源 |
|---------|---------|
| 新增任务 | NEXT.md（手动规划） |
| 完成状态 | Google Tasks（手机操作） |
| 任务详情 | NEXT.md（保留上下文） |

## 维护节奏

| 频率 | 动作 |
|------|------|
| **每天早上** | 从待办拉任务到今天 |
| **每天晚上** | 运行同步，更新完成状态 |
| **每周一次** | 检查阻塞任务，清理已完成归档 |

## 命令参考（规划中）

```bash
pm next              # 查看所有项目的任务汇总
pm next --push       # 推送到 Google Tasks
pm next --pull       # 从 Google Tasks 拉取完成状态
pm next --sync       # 双向同步
```

---

*规范版本: v1.0*
*创建日期: 2025-12-23*
